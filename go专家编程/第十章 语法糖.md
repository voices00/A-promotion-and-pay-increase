## 第十章 语法糖 & 编程陷阱

​	语法糖用于表示编程语言中的某种类型的语法，这些语法不会影响功能，但使用起来却很方便。

### 10.1 简短变量声明

​	想要声明变量，可以使用关键字`var`或者直接使用简短变量声明（`:=`），后者使用更频繁一些，尤其是在接收函数返回值场景中， 

#### 使用规则

> ​	多变量赋值可能会重新声明：重新声明并没有什么问题，它并没有引入新的变量，只是把变量的值改变了，但要明白，这是Go提供的一个语法糖。当`:=`左侧存在新变量时（如field2），那么已声明的变量（如offset）则会被重新声明，不会有其他额外副作用。当`:=`左侧没有新变量是不允许的。
>
> ​	不能用于函数外部

### 10.2 可变参数

​	 可变参函数是指函数的某个参数可有可无，即这个参数个数可以是0个或多个。
声明可变参数函数的方式是在参数类型前加上`...`前缀。 

​	可变参数必须要位于函数列表尾部；

​	可变参数是被当作切片来处理的；

​	函数调用时，可变参数可以不填；

​	函数调用时，可变参数可以填入切片。

### 10.3 编程陷阱

> 切片扩容会改变切片地址

​	 `append`的本质是向切片中追加数据，而随着切片中元素逐渐增加，当切片底层的数组将满时，切片会发生扩容，  实际使用时应该总是接收该返回值。 

> append可以追加nil	

​	 向切片中追加一个`nil`值是不会报错的，  经过追加后，slice的长度递增1。 使用append时应尽量避免追加无意义的元素。

> 循环变量引用

​	在go中，循环变量i只分配一次地址，for i:=1;i<n;i++{out=append(out,&i)}，在n次循环中，i存储的值依次是1、2、···、n，但是i的地址没有变化。

> 协程引用循环变量

​	循环变量是易变的：循环变量是一个普通的变量。语句`for index, value := range xxx`中，每次循环index和value都会被重新赋值（并非生成新的变量）。如果循环体中会启动协程（并且协程会使用循环变量），就需要格外注意了，因为很可能循环结束后协程才开始执行，此时，所有协程使用的循环变量有可能已被改写。（是否会改写取决于引用循环变量的方式）

​	循环变量需要绑定：函数体中引用需要显示地绑定。或者协程函数体没有直接引用循环变量，而是使用的参数。而在创建协程时，循环变量作为函数参数传递给了协程。参数传递的过程实际上也生成了新的变量，即间接完成了绑定。 

